<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”® SoulCard - AI ìƒë‹´ ì‹œìŠ¤í…œ</title>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@11.0.24/dist/framer-motion.js"></script>
    
    <!-- Figma Design System CSS -->
    <link rel="stylesheet" href="css/figma-design-system.css">
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--figma-gradient-dark);
        }
        
        .consultation-app {
            width: 100%;
            min-height: 100vh;
            margin: 0;
            background: var(--figma-gradient-dark);
        }
        
        /* ë°ìŠ¤í¬í†±ì—ì„œë§Œ ëª¨ë°”ì¼ í”„ë ˆì„ íš¨ê³¼ */
        @media (min-width: 1024px) {
            .consultation-app {
                max-width: 393px;
                margin: 20px auto;
                border: 3px solid #333;
                border-radius: 30px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                min-height: 852px;
                max-height: 90vh;
                overflow: hidden;
            }
        }
        
        /* ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes shuffle {
            0% { transform: rotateY(0deg) scale(1); }
            50% { transform: rotateY(180deg) scale(0.8); }
            100% { transform: rotateY(0deg) scale(1); }
        }
        
        .card-shuffle {
            animation: shuffle 0.8s ease-in-out infinite;
        }
        
        @keyframes flipCard {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(180deg); }
        }
        
        .card-flip {
            animation: flipCard 0.6s ease-in-out;
        }
        
        .card-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .card-selected {
            transform: scale(1.05);
            border-color: var(--figma-primary-400);
            box-shadow: 0 0 20px rgba(129, 140, 248, 0.5);
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { motion, AnimatePresence } = Motion;
        
        // Icon Components
        const ArrowLeft = () => <span style={{fontSize: '20px'}}>â†</span>;
        const Heart = () => <span style={{fontSize: '24px'}}>ğŸ’–</span>;
        const Briefcase = () => <span style={{fontSize: '24px'}}>ğŸ’¼</span>;
        const DollarSign = () => <span style={{fontSize: '24px'}}>ğŸ’°</span>;
        const Activity = () => <span style={{fontSize: '24px'}}>â¤ï¸â€ğŸ©¹</span>;
        const Users = () => <span style={{fontSize: '24px'}}>ğŸ‘¥</span>;
        const GraduationCap = () => <span style={{fontSize: '24px'}}>ğŸ“</span>;
        const Sparkles = () => <span style={{fontSize: '24px'}}>âœ¨</span>;
        const Compass = () => <span style={{fontSize: '24px'}}>ğŸ§­</span>;
        const Check = () => <span style={{fontSize: '16px'}}>âœ…</span>;
        const Copy = () => <span style={{fontSize: '16px'}}>ğŸ“‹</span>;
        const Volume2 = () => <span style={{fontSize: '16px'}}>ğŸ”Š</span>;
        const RefreshCw = () => <span style={{fontSize: '16px'}}>ğŸ”„</span>;

        // ìƒë‹´ ì¹´í…Œê³ ë¦¬ ë°ì´í„°
        const CONSULTATION_CATEGORIES = [
            {
                id: 'love',
                nameKo: 'ì—°ì• ãƒ»ì¸ê°„ê´€ê³„',
                icon: Heart,
                color: 'text-figma-love-color',
                bgColor: 'from-pink-500/20 to-rose-400/10',
                descriptionKo: 'ì—°ì• ì™€ ì¸ê°„ê´€ê³„ì— ëŒ€í•œ ê¶ê¸ˆì¦ì„ í•´ê²°í•´ë“œë ¤ìš”'
            },
            {
                id: 'career',
                nameKo: 'ì§ì—…ãƒ»ì§„ë¡œ',
                icon: Briefcase,
                color: 'text-figma-career-color',
                bgColor: 'from-blue-500/20 to-cyan-400/10',
                descriptionKo: 'ì§ì—…ê³¼ ì»¤ë¦¬ì–´ì— ëŒ€í•œ ì¡°ì–¸ì„ ë°›ì•„ë³´ì„¸ìš”'
            },
            {
                id: 'money',
                nameKo: 'ì¬ë¬¼ãƒ»ì¬ì •',
                icon: DollarSign,
                color: 'text-figma-money-color',
                bgColor: 'from-green-500/20 to-emerald-400/10',
                descriptionKo: 'ê¸ˆì „ìš´ê³¼ íˆ¬ìì— ëŒ€í•œ í†µì°°ì„ ì–»ì–´ë³´ì„¸ìš”'
            },
            {
                id: 'health',
                nameKo: 'ê±´ê°•ãƒ»ì›°ë¹™',
                icon: Activity,
                color: 'text-figma-health-color',
                bgColor: 'from-red-500/20 to-orange-400/10',
                descriptionKo: 'ëª¸ê³¼ ë§ˆìŒì˜ ê±´ê°•ì— ëŒ€í•´ ì•Œì•„ë³´ì„¸ìš”'
            },
            {
                id: 'relationships',
                nameKo: 'ì¸ê°„ê´€ê³„ãƒ»ê°€ì¡±',
                icon: Users,
                color: 'text-figma-accent-purple',
                bgColor: 'from-purple-500/20 to-violet-400/10',
                descriptionKo: 'ê°€ì¡±ê³¼ ì¸ê°„ê´€ê³„ì˜ ì¡°í™”ë¥¼ ì°¾ì•„ë³´ì„¸ìš”'
            },
            {
                id: 'growth',
                nameKo: 'ìì•„ì„±ì¥ãƒ»í•™ìŠµ',
                icon: GraduationCap,
                color: 'text-figma-accent-gold',
                bgColor: 'from-yellow-500/20 to-amber-400/10',
                descriptionKo: 'ê°œì¸ì  ì„±ì¥ê³¼ í•™ìŠµì— ëŒ€í•œ ë°©í–¥ì„ ì œì‹œí•´ë“œë ¤ìš”'
            },
            {
                id: 'spiritual',
                nameKo: 'ì˜ì  ì„±ì¥',
                icon: Sparkles,
                color: 'text-figma-spiritual-color',
                bgColor: 'from-indigo-500/20 to-purple-400/10',
                descriptionKo: 'ì˜ì  ë°œì „ê³¼ ë‚´ë©´ì˜ í‰í™”ë¥¼ ì°¾ì•„ë³´ì„¸ìš”'
            },
            {
                id: 'general',
                nameKo: 'ì¢…í•©ãƒ»ì „ë°˜',
                icon: Compass,
                color: 'text-figma-primary-400',
                bgColor: 'from-blue-600/20 to-indigo-400/10',
                descriptionKo: 'ì¸ìƒ ì „ë°˜ì— ëŒ€í•œ ì¢…í•©ì ì¸ ì¡°ì–¸ì„ ë°›ì•„ë³´ì„¸ìš”'
            }
        ];

        // ìƒë‹´ íƒ€ì… ë°ì´í„°
        const CONSULTATION_TYPES = {
            love: [
                {
                    id: 'love-daily',
                    nameKo: 'ì˜¤ëŠ˜ì˜ ì—°ì• ìš´',
                    descriptionKo: 'ì˜¤ëŠ˜ í•˜ë£¨ ì—°ì• ìš´ì„ í™•ì¸í•´ë³´ì„¸ìš”',
                    cardCount: 1,
                    duration: 5,
                    popular: false
                },
                {
                    id: 'love-three-card',
                    nameKo: 'ì—°ì•  ì‚¼ê°í¸',
                    descriptionKo: 'ê³¼ê±°, í˜„ì¬, ë¯¸ë˜ ì—°ì• ìš´ì„ ì¢…í•©ì ìœ¼ë¡œ',
                    cardCount: 3,
                    duration: 15,
                    popular: true
                }
            ],
            career: [
                {
                    id: 'career-guidance',
                    nameKo: 'ì§„ë¡œ ìƒë‹´',
                    descriptionKo: 'í˜„ì¬ ì§ì—…ê³¼ ë¯¸ë˜ ë°©í–¥ì„±ì— ëŒ€í•œ ì¡°ì–¸',
                    cardCount: 3,
                    duration: 15,
                    popular: true
                },
                {
                    id: 'career-cross',
                    nameKo: 'ì§ì—… ì‹­ìê°€',
                    descriptionKo: 'ì§ì—… ê´€ë ¨ ì¢…í•©ì ì¸ 4ê°€ì§€ ê´€ì ',
                    cardCount: 4,
                    duration: 20,
                    popular: false
                }
            ],
            money: [
                {
                    id: 'money-flow',
                    nameKo: 'ì¬ë¬¼ íë¦„',
                    descriptionKo: 'ê¸ˆì „ì  íë¦„ê³¼ íˆ¬ì ìš´ì„¸',
                    cardCount: 3,
                    duration: 15,
                    popular: true
                }
            ],
            health: [
                {
                    id: 'health-wellbeing',
                    nameKo: 'ê±´ê°•ê³¼ ì›°ë¹™',
                    descriptionKo: 'ëª¸ê³¼ ë§ˆìŒì˜ ê· í˜•ê³¼ ê±´ê°•',
                    cardCount: 2,
                    duration: 10,
                    popular: false
                }
            ],
            relationships: [
                {
                    id: 'relationships-harmony',
                    nameKo: 'ì¸ê°„ê´€ê³„ ì¡°í™”',
                    descriptionKo: 'ì£¼ë³€ ì‚¬ëŒë“¤ê³¼ì˜ ê´€ê³„ ê°œì„ ',
                    cardCount: 3,
                    duration: 15,
                    popular: false
                }
            ],
            growth: [
                {
                    id: 'growth-direction',
                    nameKo: 'ì„±ì¥ ë°©í–¥',
                    descriptionKo: 'ê°œì¸ì  ë°œì „ê³¼ í•™ìŠµ ë°©í–¥',
                    cardCount: 3,
                    duration: 15,
                    popular: false
                }
            ],
            spiritual: [
                {
                    id: 'spiritual-chakra',
                    nameKo: 'ì°¨í¬ë¼ ë°¸ëŸ°ìŠ¤',
                    descriptionKo: '7ê°œ ì°¨í¬ë¼ì˜ ê· í˜•ê³¼ ì—ë„ˆì§€',
                    cardCount: 7,
                    duration: 30,
                    popular: false
                }
            ],
            general: [
                {
                    id: 'general-daily',
                    nameKo: 'ì˜¤ëŠ˜ì˜ í•œ ì¥',
                    descriptionKo: 'ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ìœ„í•œ ì¡°ì–¸',
                    cardCount: 1,
                    duration: 5,
                    popular: true
                },
                {
                    id: 'general-celtic-cross',
                    nameKo: 'ì¼ˆí‹± í¬ë¡œìŠ¤',
                    descriptionKo: 'ì¸ìƒ ì „ë°˜ì— ëŒ€í•œ ì¢…í•©ì ì¸ í•´ì„',
                    cardCount: 10,
                    duration: 45,
                    popular: false
                }
            ]
        };

        // íƒ€ë¡œì¹´ë“œ ë°ì´í„° (ê°„ì†Œí™”ëœ ë²„ì „)
        const TAROT_CARDS = [
            {
                id: 'fool',
                nameKo: 'ë°”ë³´(The Fool)',
                suit: 'major',
                keywords: ['ìƒˆì‹œì‘', 'ëª¨í—˜', 'ìˆœìˆ˜'],
                image: '/images/cards/major-arcana/00-the-fool.webp',
                meanings: {
                    love: 'ìƒˆë¡œìš´ ì—°ì• ì˜ ì‹œì‘, ìˆœìˆ˜í•œ ì‚¬ë‘',
                    career: 'ìƒˆë¡œìš´ ì§ì—…ì´ë‚˜ í”„ë¡œì íŠ¸ì˜ ì‹œì‘',
                    money: 'íˆ¬ìë‚˜ ìƒˆë¡œìš´ ìˆ˜ì…ì›ì˜ ê°€ëŠ¥ì„±',
                    health: 'ìƒˆë¡œìš´ ê±´ê°• ìŠµê´€ì˜ ì‹œì‘',
                    general: 'ì¸ìƒì˜ ìƒˆë¡œìš´ ì „í™˜ì '
                }
            },
            {
                id: 'magician',
                nameKo: 'ë§ˆë²•ì‚¬(The Magician)',
                suit: 'major',
                keywords: ['ì°½ì¡°', 'ì˜ì§€', 'ëŠ¥ë ¥'],
                image: '/images/cards/major-arcana/01-the-magician.webp',
                meanings: {
                    love: 'ì ê·¹ì ì¸ ì—°ì•  ì ‘ê·¼, ë§¤ë ¥ì ì¸ ë§Œë‚¨',
                    career: 'ê°œì¸ ëŠ¥ë ¥ì˜ ë°œíœ˜, ì„±ê³µì ì¸ í”„ë¡œì íŠ¸',
                    money: 'ì˜ì§€ì™€ ëŠ¥ë ¥ì„ í†µí•œ ì¬ì • ê°œì„ ',
                    health: 'ìê¸° ì¹˜ìœ ë ¥ê³¼ íšŒë³µë ¥',
                    general: 'ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ê°•í•œ ì˜ì§€'
                }
            },
            {
                id: 'star',
                nameKo: 'ë³„(The Star)',
                suit: 'major',
                keywords: ['í¬ë§', 'ì˜ê°', 'ì¹˜ìœ '],
                image: '/images/cards/major-arcana/17-the-star.webp',
                meanings: {
                    love: 'í¬ë§ì ì¸ ì—°ì• , ë§ˆìŒì˜ ì¹˜ìœ ',
                    career: 'ì¥ê¸°ì ì¸ ëª©í‘œì™€ ë¹„ì „',
                    money: 'ì•ˆì •ì ì¸ ì¬ì • ê³„íš',
                    health: 'ëª¸ê³¼ ë§ˆìŒì˜ ì¹˜ìœ ',
                    general: 'ë°ì€ ë¯¸ë˜ì— ëŒ€í•œ í™•ì‹ '
                }
            },
            // ë” ë§ì€ ì¹´ë“œë“¤...
            ...Array.from({length: 75}, (_, i) => ({
                id: `card-${i + 4}`,
                nameKo: `íƒ€ë¡œì¹´ë“œ ${i + 4}`,
                suit: ['cups', 'wands', 'swords', 'pentacles'][i % 4],
                keywords: ['í‚¤ì›Œë“œ1', 'í‚¤ì›Œë“œ2', 'í‚¤ì›Œë“œ3'],
                image: `/images/cards/placeholder-${i + 4}.webp`,
                meanings: {
                    love: 'ì—°ì• ì— ê´€í•œ ì¡°ì–¸ì…ë‹ˆë‹¤.',
                    career: 'ì§ì—…ì— ê´€í•œ ì¡°ì–¸ì…ë‹ˆë‹¤.',
                    money: 'ì¬ë¬¼ì— ê´€í•œ ì¡°ì–¸ì…ë‹ˆë‹¤.',
                    health: 'ê±´ê°•ì— ê´€í•œ ì¡°ì–¸ì…ë‹ˆë‹¤.',
                    general: 'ì „ë°˜ì ì¸ ì¡°ì–¸ì…ë‹ˆë‹¤.'
                }
            }))
        ];

        // ì§ˆë¬¸ ì˜ˆì‹œ ë°ì´í„°
        const QUESTION_SUGGESTIONS = {
            love: [
                'í˜„ì¬ ì—°ì¸ê³¼ì˜ ê´€ê³„ëŠ” ì–´ë–»ê²Œ ë°œì „í• ê¹Œìš”?',
                'ìƒˆë¡œìš´ ë§Œë‚¨ì´ ì–¸ì œì¯¤ ìˆì„ê¹Œìš”?',
                'ì¸íƒ€ëŠ” ì‚¬ëŒê³¼ ì§„ì „ì´ ìˆì„ê¹Œìš”?',
                'ì´ë³„í•œ ì—°ì¸ê³¼ ì¬íšŒí•  ìˆ˜ ìˆì„ê¹Œìš”?'
            ],
            career: [
                'í˜„ì¬ ì§ì¥ì—ì„œ ìŠ¹ì§„ ê°€ëŠ¥ì„±ì€?',
                'ì´ì§ì„ ê³ ë ¤í•˜ê³  ìˆëŠ”ë° ì–´ë–¨ê¹Œìš”?',
                'ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ì˜ ì„±ê³µ ê°€ëŠ¥ì„±ì€?',
                'ì°½ì—…ì„ í•˜ë©´ ì–´ë–¨ê¹Œìš”?'
            ],
            money: [
                'íˆ¬ìë¥¼ ê³ ë ¤í•˜ê³  ìˆëŠ”ë° ì–´ë–¨ê¹Œìš”?',
                'ì¬ì • ìƒí™©ì´ ë‚˜ì•„ì§ˆê¹Œìš”?',
                'ë¶€ì—…ì„ ì‹œì‘í•˜ë©´ ì–´ë–¨ê¹Œìš”?',
                'í° ì§€ì¶œì„ ê³„íší•˜ê³  ìˆëŠ”ë° ê´œì°®ì„ê¹Œìš”?'
            ],
            // ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë“¤...
            general: [
                'ì•ìœ¼ë¡œ 1ê°œì›” ë™ì•ˆ ì–´ë–¤ ì¼ì´ ì¼ì–´ë‚ ê¹Œìš”?',
                'ì¤‘ìš”í•œ ê²°ì •ì„ ì•ë‘ê³  ìˆì–´ìš”. ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?',
                'í˜„ì¬ ìƒí™©ì—ì„œ ê°€ì¥ ì§‘ì¤‘í•´ì•¼ í•  ê²ƒì€?',
                'ì¸ìƒì˜ ë°©í–¥ì„±ì— ëŒ€í•œ ì¡°ì–¸ì„ êµ¬í•´ìš”.'
            ]
        };

        // Progress Bar ì»´í¬ë„ŒíŠ¸
        function ProgressBar({ currentStep }) {
            const steps = ['category-selection', 'type-selection', 'question-input', 'card-selection', 'result'];
            const progress = ((steps.indexOf(currentStep) + 1) / steps.length) * 100;
            
            return (
                <div className="w-full h-1 bg-white bg-opacity-20 rounded-full overflow-hidden">
                    <motion.div
                        className="h-full bg-gradient-to-r from-figma-primary-400 to-figma-accent-purple"
                        initial={{ width: 0 }}
                        animate={{ width: `${progress}%` }}
                        transition={{ duration: 0.5 }}
                    />
                </div>
            );
        }

        // Step 1: ì¹´í…Œê³ ë¦¬ ì„ íƒ
        function CategorySelectionStep({ onCategorySelect }) {
            return (
                <motion.div
                    key="category-selection"
                    initial={{ opacity: 0, x: 50 }}
                    animate={{ opacity: 1, x: 0 }}
                    exit={{ opacity: 0, x: -50 }}
                    transition={{ duration: 0.3 }}
                    className="px-6 pb-6"
                >
                    <div className="text-center mb-8">
                        <h1 className="text-white text-2xl font-bold mb-2">ìƒë‹´ ë¶„ì•¼ ì„ íƒ</h1>
                        <p className="text-white opacity-70 text-sm">ì–´ë–¤ ë¶„ì•¼ì— ëŒ€í•´ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?</p>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                        {CONSULTATION_CATEGORIES.map((category, index) => {
                            const IconComponent = category.icon;
                            return (
                                <motion.button
                                    key={category.id}
                                    initial={{ opacity: 0, y: 20 }}
                                    animate={{ opacity: 1, y: 0 }}
                                    transition={{ delay: index * 0.1 }}
                                    onClick={() => onCategorySelect(category)}
                                    className={`p-4 rounded-xl bg-gradient-to-br ${category.bgColor} border border-white border-opacity-10 hover:border-white hover:border-opacity-20 transition-all group hover:scale-105`}
                                >
                                    <div className="flex flex-col items-center text-center">
                                        <div className="w-12 h-12 bg-white bg-opacity-10 rounded-full flex items-center justify-center mb-3">
                                            <IconComponent />
                                        </div>
                                        <h3 className="text-white font-semibold text-sm mb-1">{category.nameKo}</h3>
                                        <p className="text-white opacity-60 text-xs leading-tight">{category.descriptionKo}</p>
                                    </div>
                                </motion.button>
                            );
                        })}
                    </div>
                </motion.div>
            );
        }

        // Step 2: íƒ€ì… ì„ íƒ
        function TypeSelectionStep({ category, onTypeSelect, onBack }) {
            const [selectedType, setSelectedType] = useState(null);
            const types = CONSULTATION_TYPES[category.id] || [];

            const handleTypeSelect = (type) => {
                setSelectedType(type);
                setTimeout(() => onTypeSelect(type), 300);
            };

            return (
                <motion.div
                    key="type-selection"
                    initial={{ opacity: 0, x: 50 }}
                    animate={{ opacity: 1, x: 0 }}
                    exit={{ opacity: 0, x: -50 }}
                    transition={{ duration: 0.3 }}
                    className="px-6 pb-6"
                >
                    <div className="flex items-center justify-between mb-6">
                        <button 
                            onClick={onBack}
                            className="w-10 h-10 rounded-full bg-white bg-opacity-10 flex items-center justify-center hover:bg-opacity-20 transition-all"
                        >
                            <ArrowLeft />
                        </button>
                        <div className="text-center">
                            <h1 className="text-white font-bold text-lg">{category.nameKo}</h1>
                        </div>
                        <div className="w-10" />
                    </div>

                    <div className="space-y-4">
                        {types.map((type, index) => (
                            <motion.button
                                key={type.id}
                                initial={{ opacity: 0, y: 20 }}
                                animate={{ opacity: 1, y: 0 }}
                                transition={{ delay: index * 0.1 }}
                                onClick={() => handleTypeSelect(type)}
                                className={`w-full p-4 rounded-xl border transition-all text-left ${
                                    selectedType?.id === type.id
                                        ? 'border-figma-primary-400 bg-figma-primary-500 bg-opacity-20'
                                        : 'border-white border-opacity-10 bg-white bg-opacity-5 hover:bg-opacity-10'
                                }`}
                            >
                                <div className="flex items-center justify-between mb-2">
                                    <h3 className="text-white font-semibold">{type.nameKo}</h3>
                                    <div className="flex items-center gap-2">
                                        {type.popular && (
                                            <span className="px-2 py-1 bg-figma-accent-gold text-black text-xs font-bold rounded">
                                                ì¸ê¸°
                                            </span>
                                        )}
                                        {selectedType?.id === type.id && <Check />}
                                    </div>
                                </div>
                                <p className="text-white opacity-70 text-sm mb-3">{type.descriptionKo}</p>
                                <div className="flex items-center justify-between text-xs text-white opacity-60">
                                    <span>ì¹´ë“œ {type.cardCount}ì¥</span>
                                    <span>ì•½ {type.duration}ë¶„</span>
                                </div>
                            </motion.button>
                        ))}
                    </div>
                </motion.div>
            );
        }

        // Step 3: ì§ˆë¬¸ ì…ë ¥
        function QuestionInputStep({ category, consultationType, onQuestionSubmit, onBack }) {
            const [question, setQuestion] = useState('');
            const suggestions = QUESTION_SUGGESTIONS[category.id] || [];

            const handleSuggestionClick = (suggestion) => {
                setQuestion(suggestion);
            };

            const handleSubmit = () => {
                if (question.trim()) {
                    onQuestionSubmit(question);
                }
            };

            return (
                <motion.div
                    key="question-input"
                    initial={{ opacity: 0, x: 50 }}
                    animate={{ opacity: 1, x: 0 }}
                    exit={{ opacity: 0, x: -50 }}
                    transition={{ duration: 0.3 }}
                    className="px-6 pb-6"
                >
                    <div className="flex items-center justify-between mb-6">
                        <button 
                            onClick={onBack}
                            className="w-10 h-10 rounded-full bg-white bg-opacity-10 flex items-center justify-center hover:bg-opacity-20 transition-all"
                        >
                            <ArrowLeft />
                        </button>
                        <div className="text-center">
                            <h1 className="text-white font-bold text-lg">ì§ˆë¬¸í•˜ê¸°</h1>
                        </div>
                        <div className="w-10" />
                    </div>

                    <div className="mb-6">
                        <div className="card-container p-4 mb-4">
                            <h3 className="text-white font-semibold mb-2">{consultationType.nameKo}</h3>
                            <p className="text-white opacity-70 text-sm">{consultationType.descriptionKo}</p>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="block text-white font-medium mb-2">
                                    êµ¬ì²´ì ì¸ ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”
                                </label>
                                <textarea
                                    value={question}
                                    onChange={(e) => setQuestion(e.target.value)}
                                    className="w-full h-24 p-3 bg-white bg-opacity-10 border border-white border-opacity-20 rounded-lg text-white placeholder-white placeholder-opacity-60 resize-none"
                                    placeholder="ê¶ê¸ˆí•œ ê²ƒì„ ììœ ë¡­ê²Œ ì§ˆë¬¸í•´ë³´ì„¸ìš”..."
                                    maxLength={200}
                                />
                                <div className="text-right text-xs text-white opacity-60 mt-1">
                                    {question.length}/200
                                </div>
                            </div>

                            <div>
                                <h4 className="text-white font-medium mb-3">ğŸ’¡ ì§ˆë¬¸ ì˜ˆì‹œ</h4>
                                <div className="space-y-2">
                                    {suggestions.map((suggestion, index) => (
                                        <button
                                            key={index}
                                            onClick={() => handleSuggestionClick(suggestion)}
                                            className="w-full p-3 text-left bg-white bg-opacity-5 hover:bg-opacity-10 border border-white border-opacity-10 rounded-lg text-white text-sm transition-all"
                                        >
                                            {suggestion}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>

                    <button
                        onClick={handleSubmit}
                        disabled={!question.trim()}
                        className={`w-full py-4 rounded-xl font-semibold transition-all ${
                            question.trim()
                                ? 'btn-primary'
                                : 'bg-white bg-opacity-10 text-white opacity-50 cursor-not-allowed'
                        }`}
                    >
                        ì¹´ë“œ ì„ íƒí•˜ê¸°
                    </button>
                </motion.div>
            );
        }

        // Step 4: ì¹´ë“œ ì„ íƒ
        function CardSelectionStep({ consultationType, question, onCardsSelected, onBack }) {
            const [isShuffling, setIsShuffling] = useState(true);
            const [availableCards, setAvailableCards] = useState([]);
            const [selectedCards, setSelectedCards] = useState([]);

            useEffect(() => {
                // ì…”í”Œ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                setTimeout(() => {
                    // ëœë¤í•˜ê²Œ 12ì¥ ì„ íƒ
                    const shuffled = [...TAROT_CARDS].sort(() => Math.random() - 0.5);
                    setAvailableCards(shuffled.slice(0, 12));
                    setIsShuffling(false);
                }, 2000);
            }, []);

            const handleCardSelect = (card, index) => {
                if (selectedCards.length >= consultationType.cardCount) return;

                const isReversed = Math.random() > 0.7; // 30% í™•ë¥ ë¡œ ì—­ë°©í–¥
                const positions = ['ê³¼ê±°', 'í˜„ì¬', 'ë¯¸ë˜', 'ì¡°ì–¸', 'ê²°ê³¼', 'ì¥ì• ë¬¼', 'í¬ë§'];
                const position = positions[selectedCards.length] || `ì¹´ë“œ ${selectedCards.length + 1}`;

                const selectedCard = {
                    ...card,
                    isReversed,
                    position,
                    index
                };

                const newSelectedCards = [...selectedCards, selectedCard];
                setSelectedCards(newSelectedCards);

                // ëª¨ë“  ì¹´ë“œê°€ ì„ íƒë˜ë©´ ê²°ê³¼ë¡œ ì´ë™
                if (newSelectedCards.length === consultationType.cardCount) {
                    setTimeout(() => {
                        onCardsSelected(newSelectedCards);
                    }, 1000);
                }
            };

            if (isShuffling) {
                return (
                    <motion.div
                        key="shuffling"
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        className="h-screen flex flex-col items-center justify-center px-6"
                    >
                        <div className="text-center mb-8">
                            <h2 className="text-white text-xl font-bold mb-2">ì¹´ë“œë¥¼ ì„ê³  ìˆìŠµë‹ˆë‹¤</h2>
                            <p className="text-white opacity-70">ë§ˆìŒì„ ì§‘ì¤‘í•´ì£¼ì„¸ìš”...</p>
                        </div>
                        
                        <div className="relative">
                            {[...Array(5)].map((_, i) => (
                                <div
                                    key={i}
                                    className="absolute w-20 h-32 card-back rounded-lg card-shuffle"
                                    style={{
                                        left: `${i * 5}px`,
                                        top: `${i * 3}px`,
                                        animationDelay: `${i * 0.2}s`,
                                        zIndex: 5 - i
                                    }}
                                />
                            ))}
                        </div>
                    </motion.div>
                );
            }

            return (
                <motion.div
                    key="card-selection"
                    initial={{ opacity: 0, x: 50 }}
                    animate={{ opacity: 1, x: 0 }}
                    exit={{ opacity: 0, x: -50 }}
                    transition={{ duration: 0.3 }}
                    className="px-6 pb-6"
                >
                    <div className="flex items-center justify-between mb-6">
                        <button 
                            onClick={onBack}
                            className="w-10 h-10 rounded-full bg-white bg-opacity-10 flex items-center justify-center hover:bg-opacity-20 transition-all"
                        >
                            <ArrowLeft />
                        </button>
                        <div className="text-center">
                            <h1 className="text-white font-bold text-lg">ì¹´ë“œ ì„ íƒ</h1>
                            <p className="text-white opacity-70 text-sm">
                                {selectedCards.length}/{consultationType.cardCount}ì¥ ì„ íƒë¨
                            </p>
                        </div>
                        <div className="w-10" />
                    </div>

                    <div className="mb-6">
                        <div className="card-container p-3">
                            <p className="text-white text-sm opacity-80">
                                "{question}"
                            </p>
                        </div>
                    </div>

                    <p className="text-white text-center opacity-70 text-sm mb-6">
                        ì§ê°ì— ë”°ë¼ {consultationType.cardCount}ì¥ì˜ ì¹´ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
                    </p>

                    <div className="grid grid-cols-3 gap-3">
                        {availableCards.map((card, index) => {
                            const isSelected = selectedCards.some(selected => selected.index === index);
                            const selectedCard = selectedCards.find(selected => selected.index === index);
                            
                            return (
                                <motion.button
                                    key={index}
                                    initial={{ opacity: 0, scale: 0.8 }}
                                    animate={{ opacity: 1, scale: 1 }}
                                    transition={{ delay: index * 0.1 }}
                                    onClick={() => !isSelected && handleCardSelect(card, index)}
                                    disabled={isSelected || selectedCards.length >= consultationType.cardCount}
                                    className={`aspect-[2/3] rounded-lg transition-all duration-300 ${
                                        isSelected 
                                            ? 'card-selected'
                                            : 'card-back hover:scale-105'
                                    } ${selectedCards.length >= consultationType.cardCount && !isSelected ? 'opacity-50' : ''}`}
                                >
                                    {isSelected && (
                                        <div className="h-full flex flex-col items-center justify-center text-white">
                                            <div className="text-2xl mb-2">ğŸƒ</div>
                                            <div className="text-xs font-bold">{selectedCard.position}</div>
                                        </div>
                                    )}
                                </motion.button>
                            );
                        })}
                    </div>
                </motion.div>
            );
        }

        // Step 5: ê²°ê³¼ í‘œì‹œ
        function ResultStep({ category, consultationType, question, selectedCards, onReset }) {
            const [copiedText, setCopiedText] = useState(null);

            const handleCopy = (text) => {
                navigator.clipboard.writeText(text);
                setCopiedText(text);
                setTimeout(() => setCopiedText(null), 2000);
            };

            const getInterpretation = (card) => {
                const categoryKey = category.id === 'relationships' ? 'general' : category.id;
                let interpretation = card.meanings[categoryKey] || 'ê¸ì •ì ì¸ ì—ë„ˆì§€ê°€ ëŠê»´ì§‘ë‹ˆë‹¤.';
                
                if (card.isReversed) {
                    interpretation += ' ë‹¤ë§Œ í˜„ì¬ëŠ” ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì ‘ê·¼í•˜ê±°ë‚˜ ë‹¤ë¥¸ ê´€ì ì—ì„œ ìƒê°í•´ë³¼ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.';
                }
                
                return interpretation;
            };

            const getOverallInterpretation = () => {
                const positiveCards = selectedCards.filter(card => !card.isReversed).length;
                const totalCards = selectedCards.length;
                
                if (positiveCards > totalCards / 2) {
                    return `ì„ íƒí•˜ì‹  ì¹´ë“œë“¤ì„ ì¢…í•©í•´ë³´ë©´, ${category.nameKo} ë¶„ì•¼ì—ì„œ ê¸ì •ì ì¸ ë³€í™”ì™€ ê¸°íšŒê°€ ë‹¤ê°€ì˜¬ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤. íŠ¹íˆ ë‚´ë©´ì˜ ì§ê°ì„ ë¯¿ê³  í–‰ë™í•  ë•Œ ì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.`;
                } else {
                    return `í˜„ì¬ ${category.nameKo} ë¶„ì•¼ì—ì„œëŠ” ì‹ ì¤‘í•œ ì ‘ê·¼ì´ í•„ìš”í•œ ì‹œê¸°ë¡œ ë³´ì…ë‹ˆë‹¤. ì„±ê¸‰í•œ ê²°ì •ë³´ë‹¤ëŠ” ì¶©ë¶„íˆ ìƒê°í•´ë³¸ í›„ í–‰ë™í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤. ë•Œë¡œëŠ” ê¸°ë‹¤ë¦¬ëŠ” ê²ƒë„ ì§€í˜œì…ë‹ˆë‹¤.`;
                }
            };

            return (
                <motion.div
                    key="result"
                    initial={{ opacity: 0, x: 50 }}
                    animate={{ opacity: 1, x: 0 }}
                    exit={{ opacity: 0, x: -50 }}
                    transition={{ duration: 0.3 }}
                    className="px-6 pb-6"
                >
                    <div className="text-center mb-6">
                        <h1 className="text-white text-xl font-bold mb-2">âœ¨ ìƒë‹´ ê²°ê³¼</h1>
                        <p className="text-white opacity-70 text-sm">{consultationType.nameKo}</p>
                    </div>

                    <div className="space-y-6">
                        {/* ì§ˆë¬¸ í‘œì‹œ */}
                        <div className="card-container p-4">
                            <h3 className="text-white font-semibold mb-2">ğŸ“ ì§ˆë¬¸</h3>
                            <p className="text-white opacity-80 text-sm">"{question}"</p>
                        </div>

                        {/* ì„ íƒëœ ì¹´ë“œë“¤ */}
                        <div className="space-y-4">
                            <h3 className="text-white font-semibold">ğŸƒ ì„ íƒëœ ì¹´ë“œ</h3>
                            {selectedCards.map((card, index) => (
                                <motion.div
                                    key={index}
                                    initial={{ opacity: 0, y: 20 }}
                                    animate={{ opacity: 1, y: 0 }}
                                    transition={{ delay: index * 0.2 }}
                                    className="card-container p-4"
                                >
                                    <div className="flex items-start gap-4">
                                        <div className="w-16 h-24 bg-gradient-to-br from-purple-500 to-blue-600 rounded-lg flex items-center justify-center text-2xl flex-shrink-0">
                                            ğŸƒ
                                        </div>
                                        <div className="flex-1">
                                            <div className="flex items-center gap-2 mb-2">
                                                <h4 className="text-white font-semibold text-sm">{card.nameKo}</h4>
                                                {card.isReversed && (
                                                    <span className="px-2 py-1 bg-orange-500 bg-opacity-20 text-orange-300 text-xs rounded">
                                                        ì—­ë°©í–¥
                                                    </span>
                                                )}
                                            </div>
                                            <p className="text-figma-primary-400 text-xs font-medium mb-1">{card.position}</p>
                                            <div className="flex flex-wrap gap-1 mb-2">
                                                {card.keywords.slice(0, 3).map((keyword, i) => (
                                                    <span key={i} className="px-2 py-1 bg-white bg-opacity-10 text-white text-xs rounded">
                                                        {keyword}
                                                    </span>
                                                ))}
                                            </div>
                                            <p className="text-white opacity-80 text-sm leading-relaxed mb-3">
                                                {getInterpretation(card)}
                                            </p>
                                            <button
                                                onClick={() => handleCopy(getInterpretation(card))}
                                                className="flex items-center gap-2 text-white opacity-60 hover:opacity-100 transition-opacity text-xs"
                                            >
                                                {copiedText === getInterpretation(card) ? <Check /> : <Copy />}
                                                ë³µì‚¬
                                            </button>
                                        </div>
                                    </div>
                                </motion.div>
                            ))}
                        </div>

                        {/* ì¢…í•© í•´ì„ */}
                        <motion.div
                            initial={{ opacity: 0, y: 20 }}
                            animate={{ opacity: 1, y: 0 }}
                            transition={{ delay: selectedCards.length * 0.2 + 0.3 }}
                            className="card-container p-4"
                        >
                            <h3 className="text-white font-semibold mb-3">ğŸ¯ ì¢…í•© í•´ì„</h3>
                            <p className="text-white opacity-80 text-sm leading-relaxed mb-4">
                                {getOverallInterpretation()}
                            </p>
                            <div className="flex items-center gap-3">
                                <button
                                    onClick={() => handleCopy(getOverallInterpretation())}
                                    className="flex items-center gap-2 text-white opacity-60 hover:opacity-100 transition-opacity text-sm"
                                >
                                    {copiedText === getOverallInterpretation() ? <Check /> : <Copy />}
                                    ë³µì‚¬
                                </button>
                                <button className="flex items-center gap-2 text-white opacity-60 hover:opacity-100 transition-opacity text-sm">
                                    <Volume2 />
                                    ë“£ê¸°
                                </button>
                            </div>
                        </motion.div>

                        {/* ì•¡ì…˜ ë²„íŠ¼ë“¤ */}
                        <div className="space-y-3 pt-4">
                            <button
                                onClick={onReset}
                                className="btn-primary w-full py-4 flex items-center justify-center gap-2"
                            >
                                <RefreshCw />
                                ìƒˆë¡œìš´ ìƒë‹´í•˜ê¸°
                            </button>
                            <div className="grid grid-cols-2 gap-3">
                                <button className="py-3 bg-white bg-opacity-10 text-white rounded-lg hover:bg-opacity-20 transition-all text-sm">
                                    ê²°ê³¼ ì €ì¥
                                </button>
                                <button className="py-3 bg-white bg-opacity-10 text-white rounded-lg hover:bg-opacity-20 transition-all text-sm">
                                    ê³µìœ í•˜ê¸°
                                </button>
                            </div>
                        </div>
                    </div>
                </motion.div>
            );
        }

        // ë©”ì¸ ìƒë‹´ ì»´í¬ë„ŒíŠ¸
        function ConsultationSystem() {
            const [currentStep, setCurrentStep] = useState('category-selection');
            const [selectedCategory, setSelectedCategory] = useState(null);
            const [selectedType, setSelectedType] = useState(null);
            const [question, setQuestion] = useState('');
            const [selectedCards, setSelectedCards] = useState([]);

            const handleCategorySelect = (category) => {
                setSelectedCategory(category);
                setCurrentStep('type-selection');
            };

            const handleTypeSelect = (type) => {
                setSelectedType(type);
                setCurrentStep('question-input');
            };

            const handleQuestionSubmit = (questionText) => {
                setQuestion(questionText);
                setCurrentStep('card-selection');
            };

            const handleCardsSelected = (cards) => {
                setSelectedCards(cards);
                setCurrentStep('result');
            };

            const handleReset = () => {
                setCurrentStep('category-selection');
                setSelectedCategory(null);
                setSelectedType(null);
                setQuestion('');
                setSelectedCards([]);
            };

            const renderStep = () => {
                switch(currentStep) {
                    case 'category-selection':
                        return (
                            <CategorySelectionStep 
                                onCategorySelect={handleCategorySelect}
                            />
                        );
                    case 'type-selection':
                        return (
                            <TypeSelectionStep 
                                category={selectedCategory}
                                onTypeSelect={handleTypeSelect}
                                onBack={() => setCurrentStep('category-selection')}
                            />
                        );
                    case 'question-input':
                        return (
                            <QuestionInputStep 
                                category={selectedCategory}
                                consultationType={selectedType}
                                onQuestionSubmit={handleQuestionSubmit}
                                onBack={() => setCurrentStep('type-selection')}
                            />
                        );
                    case 'card-selection':
                        return (
                            <CardSelectionStep 
                                consultationType={selectedType}
                                question={question}
                                onCardsSelected={handleCardsSelected}
                                onBack={() => setCurrentStep('question-input')}
                            />
                        );
                    case 'result':
                        return (
                            <ResultStep 
                                category={selectedCategory}
                                consultationType={selectedType}
                                question={question}
                                selectedCards={selectedCards}
                                onReset={handleReset}
                            />
                        );
                    default:
                        return null;
                }
            };

            return (
                <div className="consultation-app figma-design">
                    {/* Header */}
                    <div className="sticky top-0 z-10 bg-figma-dark-bg-secondary border-b border-white border-opacity-10">
                        <div className="flex items-center justify-between p-4">
                            <div className="flex items-center gap-2">
                                <span className="text-2xl">ğŸ”®</span>
                                <span className="text-white font-bold">AI íƒ€ë¡œ ìƒë‹´</span>
                            </div>
                            <div className="text-white opacity-70 text-sm">
                                í† í° 12ê°œ
                            </div>
                        </div>
                        <div className="px-4 pb-4">
                            <ProgressBar currentStep={currentStep} />
                        </div>
                    </div>

                    {/* Content */}
                    <div className="min-h-screen pt-6">
                        <AnimatePresence mode="wait">
                            {renderStep()}
                        </AnimatePresence>
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<ConsultationSystem />, document.getElementById('app'));
    </script>
</body>
</html>