# 🏗️ AI 타로카드 앱 v2.0 시스템 아키텍처

## 📋 문서 정보
**작성일**: 2025년 7월 29일  
**버전**: v2.0 (Phase 3.1 완성)  
**담당자**: Claude AI Assistant

---

## 🌟 **전체 시스템 개요**

### **아키텍처 철학**
- **실시간 AI 기반**: WebSocket + 머신러닝 통합
- **모듈화 설계**: 각 기능별 독립적 모듈 구성
- **확장 가능**: 새로운 분석 엔진 및 기능 추가 용이
- **타입 안전성**: TypeScript 엄격 모드로 개발

### **시스템 구성도**
```
┌─────────────────────────────────────────────────────────────┐
│                    Client (Browser)                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  HTTP API   │  │  WebSocket  │  │  Static Frontend    │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                    Express.js Server                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ REST Routes │  │ WebSocket   │  │  Static Serving     │  │
│  │             │  │ Handler     │  │                     │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                   Core Services Layer                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ Tarot       │  │ AI Narrative│  │  Card Management    │  │
│  │ Reading     │  │ Engine      │  │                     │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                    AI Analysis Layer                       │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ NLP         │  │ Psychology  │  │  Emotion Analysis   │  │
│  │ Processor   │  │ Analyzer    │  │                     │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                 Machine Learning Layer                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ Prediction  │  │Personalizat-│  │  Real-time          │  │
│  │ Engine      │  │ion System   │  │  Analyzer           │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                      Data Layer                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ Tarot Cards │  │ Combinations│  │  User Sessions      │  │
│  │ (JSON)      │  │ (JSON)      │  │  (Memory)           │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔗 **계층별 상세 구조**

### **1. 클라이언트 레이어**
```typescript
// HTTP API 통신
- POST /api/reading/single
- POST /api/reading/three-card  
- POST /api/reading/relationship
- POST /api/reading/celtic-cross
- POST /api/analyze-question
- GET /api/status

// WebSocket 통신
- session:start
- typing:event
- question:update
- activity:update
- feedback:realtime
- session:end
```

### **2. 서버 레이어** (`/server/`)
```typescript
app.ts                 // Express 서버 + HTTP 서버 통합
websocket-server.ts    // Socket.IO 실시간 서버
```

### **3. 핵심 서비스 레이어** (`/services/`)
```typescript
tarotReading.ts        // 타로 리딩 로직
aiNarrativeEngine.ts   // AI 스토리텔링
```

### **4. AI 분석 레이어** (`/ai/`)
```typescript
nlp-processor.ts       // 자연어 처리 엔진
psychology-analyzer.ts // 융 심리학 분석
emotion-analyzer.ts    // 감정 분석 시스템
```

### **5. 머신러닝 레이어** (`/ml/`)
```typescript
prediction-engine.ts   // TensorFlow.js 예측 모델
personalization.ts     // 개인화 학습 시스템
```

### **6. 실시간 분석 레이어** (`/analytics/`)
```typescript
real-time-analyzer.ts  // 실시간 분석 시스템
```

### **7. 데이터 레이어** (`/data/`, `/utils/`)
```typescript
cardLoader.ts         // 카드 데이터 관리
cardRenderer.ts       // 카드 시각화
```

---

## 🔄 **데이터 플로우**

### **일반 타로 리딩 플로우**
```
1. 사용자 질문 입력
   ↓
2. NLP 처리 (의도, 감정, 키워드 분석)
   ↓  
3. 심리 분석 (융 성격 유형, 원형 분석)
   ↓
4. 감정 분석 (치료적 필요, 감정 여정)
   ↓
5. ML 예측 (최적 카드 추천)
   ↓
6. 카드 선택 및 해석 생성
   ↓
7. AI 내러티브 생성 (스토리텔링)
   ↓
8. 클라이언트 응답
```

### **실시간 분석 플로우**
```
1. WebSocket 세션 시작
   ↓
2. 타이핑 이벤트 수집
   ↓
3. 실시간 패턴 분석 (속도, 리듬, 수정)
   ↓
4. 감정 상태 실시간 추적
   ↓
5. ML 예측 및 개인화
   ↓
6. 즉시 피드백 생성
   ↓
7. 클라이언트 실시간 업데이트
```

---

## 🛠️ **핵심 기술 스택**

### **백엔드**
- **언어**: TypeScript 5.x
- **런타임**: Node.js 18+
- **웹 프레임워크**: Express.js 4.x
- **실시간 통신**: Socket.IO 4.x
- **빌드 도구**: TypeScript Compiler

### **AI/ML**
- **자연어 처리**: 커스텀 NLP 엔진
- **심리 분석**: 융 심리학 기반 알고리즘
- **머신러닝**: TensorFlow.js 시뮬레이션
- **실시간 분석**: 이벤트 스트림 처리

### **데이터**
- **데이터베이스**: JSON 파일 시스템
- **세션 관리**: 메모리 기반 (확장 예정: Redis)
- **데이터 구조**: 강타입 TypeScript 인터페이스

### **프론트엔드**
- **기술**: Vanilla JavaScript, HTML5, CSS3
- **통신**: Fetch API + WebSocket
- **스타일링**: 그라데이션 모던 UI

---

## 📊 **성능 특성**

### **응답 시간**
- **일반 리딩**: < 500ms
- **실시간 분석**: < 100ms  
- **ML 예측**: < 200ms
- **WebSocket 통신**: < 50ms

### **동시성**
- **HTTP 요청**: Express.js 기본 처리
- **WebSocket 세션**: 독립적 다중 세션
- **메모리 사용**: 세션당 ~10MB

### **확장성**
- **수평 확장**: 로드 밸런서 + 다중 인스턴스
- **수직 확장**: CPU/메모리 증설 대응
- **모듈 확장**: 플러그인 아키텍처

---

## 🔒 **보안 고려사항**

### **현재 구현**
- **CORS 설정**: 모든 도메인 허용 (개발용)
- **입력 검증**: 7단계 질문 유효성 검사
- **에러 처리**: 상세 에러 정보 숨김

### **프로덕션 보안 (Phase 4.3)**
- **JWT 인증**: 사용자 세션 관리
- **API 레이트 리미팅**: DDoS 방지
- **입력 새니타이징**: XSS 방지
- **HTTPS 강제**: SSL/TLS 암호화

---

## 🧪 **테스트 전략**

### **단위 테스트**
```
/tests/
├── test-validation.js          # 질문 유효성
├── test-extreme-cases.js       # 극단적 케이스  
├── test-single-card-validation.js  # 단일 카드
├── test-server-validation.js   # 서버 응답
├── test-question-analysis.js   # 질문 분석
├── test-web-analysis.js        # 웹 API 종합
├── test-web-validation.js      # 웹 검증
└── test-server.js             # 기본 서버
```

### **통합 테스트**
- **API 엔드포인트**: 전체 리딩 플로우
- **WebSocket**: 실시간 통신 시나리오  
- **ML 파이프라인**: 예측 정확도 검증

---

## 📈 **모니터링 및 로깅**

### **현재 로깅**
```typescript
console.log('🔮 타로 앱 서버 초기화 완료');
console.log('✨ WebSocket 실시간 분석 서버 초기화 완료');
console.log('🎯 실시간 세션 시작: ${sessionId}');
```

### **프로덕션 모니터링 (Phase 4.3)**
- **APM**: Application Performance Monitoring
- **로그 수집**: Winston + ELK Stack
- **메트릭**: Prometheus + Grafana
- **알림**: Slack/Discord 통합

---

## 🔮 **미래 확장 계획**

### **Phase 4.1: 프론트엔드 실시간 UI**
- 실시간 분석 결과 시각화
- 타이핑 상태 실시간 표시
- 질문 예측 자동완성
- 감정 여정 차트

### **Phase 4.2: 고급 AI 분석**
- 질문 의도별 특화 엔진
- 시간대/패턴 분석
- 멀티모달 입력 (음성, 이미지)
- 장기적 성장 추적

### **Phase 4.3: 프로덕션 최적화**
- Redis 세션 관리
- JWT 인증 시스템
- API 게이트웨이
- 컨테이너화 (Docker)

### **Phase 5: 모바일 및 고급 기능**
- React Native 앱
- 실시간 채팅 상담
- 다국어 지원
- 커뮤니티 기능

---

## 💡 **아키텍처의 혁신성**

1. **실시간 심리 분석**: 타이핑 패턴만으로 감정 상태 파악
2. **예측적 UX**: 질문 완성 전 의도 예측
3. **적응형 AI**: 개인별 학습 기반 맞춤형 경험
4. **통합 분석 파이프라인**: NLP + 심리학 + ML 완전 통합

---

## 📝 **개발 표준**

### **코드 스타일**
- **타입 안전성**: 모든 인터페이스 정의
- **모듈화**: 단일 책임 원칙
- **에러 처리**: try-catch 완전 구현
- **문서화**: JSDoc 주석 필수

### **디렉토리 구조**
```
/
├── server/          # Express + WebSocket 서버
├── services/        # 핵심 비즈니스 로직
├── ai/             # AI 분석 엔진들
├── ml/             # 머신러닝 모델들
├── analytics/      # 실시간 분석
├── utils/          # 유틸리티 함수들
├── types/          # TypeScript 타입 정의
├── data/           # 타로 데이터
├── public/         # 정적 웹 파일
├── tests/          # 테스트 스위트
└── docs/           # 문서들
```

---

**📝 작성자**: Claude (AI Assistant)  
**🔄 업데이트**: Phase별 주요 변경사항 시마다  
**📧 문의**: 개발팀 또는 AI Assistant

---

*이 문서는 AI 타로카드 앱 v2.0의 전체 시스템 아키텍처를 포괄적으로 설명합니다.*